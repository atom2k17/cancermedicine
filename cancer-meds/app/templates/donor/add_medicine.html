{% extends "base.html" %}
{% block content %}
<div class="form-container">
	<h3>Add Donation</h3>
	<form method="POST" enctype="multipart/form-data" onsubmit="return validateForm()">
		{{ form.hidden_tag() }}
		<div class="mb-3">
			{{ form.name.label }}
			{{ form.name(class="form-control", required=True) }}
		</div>
		<div class="mb-3">
			{{ form.quantity.label }}
			{{ form.quantity(class="form-control", required=True, min=1) }}
		</div>
		<div class="mb-3">
			{{ form.expiry_date.label }}
			{{ form.expiry_date(class="form-control", required=True, id="expiry_date") }}
		</div>
		<div class="mb-3">
			<label for="location">Location</label>
			<input type="text" name="location" id="location" class="form-control" placeholder="City, address or coordinates" required>
		</div>
		<div class="mb-3">
			<small class="form-text text-muted">Note: we use your account location to show matches on the map. You can edit your profile location later.</small>
		</div>
		<div class="mb-3">
			<label for="images">Upload photos (optional - max 3 images)</label>
			<div style="background: #f0f8ff; border-left: 4px solid #667eea; padding: 1.2rem; border-radius: 6px; margin-bottom: 1rem;">
				<p style="margin: 0 0 0.8rem 0; font-weight: 600; color: #2c3e50;">ðŸ“¸ What to include in your photos:</p>
				<ul style="margin: 0; padding-left: 1.5rem; color: #555; line-height: 1.6;">
					<li><strong>Medicine name</strong> - clearly visible on the box/label</li>
					<li><strong>Expiry date</strong> - must be clear and readable</li>
					<li><strong>Batch number</strong> - visible on the packaging</li>
					<li><strong>Overall condition</strong> - show the entire medicine packaging</li>
				</ul>
				<p style="margin: 0.8rem 0 0 0; color: #666; font-style: italic; font-size: 0.95rem;">ðŸ’¡ Tip: Upload multiple images from different angles if possible for ease in verification (max 3 images)</p>
			</div>
			<input type="file" name="images" id="images" class="form-control" accept="image/*" multiple onchange="validateImageCount(this)">
			<small id="image-count" style="color: #666; margin-top: 0.5rem;"></small>
		</div>
		<div style="display: flex; gap: 0.8rem;">
			<button type="submit" class="btn btn-success" style="color: white; font-weight: 600; padding: 0.6rem 1.5rem;">Save</button>
			<a href="{{ url_for('meds.my_donations') }}" class="btn btn-outline-secondary" style="width: auto; flex: 1; font-weight: 600; color: #555; border-color: #999;">Cancel</a>
		</div>
	</form>
</div>

<script>
function validateForm() {
	var expiryInput = document.getElementById('expiry_date');
	var today = new Date();
	today.setHours(0, 0, 0, 0);
	
	if (expiryInput.value) {
		var expiryDate = new Date(expiryInput.value);
		if (expiryDate < today) {
			alert('Expiry date cannot be in the past');
			return false;
		}
	}
	return true;
}

function validateImageCount(input) {
	var files = input.files;
	var countElement = document.getElementById('image-count');
	
	if (files.length > 3) {
		alert('Maximum 3 images allowed');
		input.value = '';
		countElement.textContent = '';
		return false;
	}
	
	if (files.length > 0) {
		countElement.textContent = `${files.length} image${files.length > 1 ? 's' : ''} selected`;
	} else {
		countElement.textContent = '';
	}
	return true;
}

document.addEventListener('DOMContentLoaded', function(){
	var expiryInput = document.getElementById('expiry_date');
	var today = new Date().toISOString().split('T')[0];
	expiryInput.min = today;
});
</script>
{% endblock %}